<style>
  .bravo_banner {
    background-image: url(https://worktel.mrhost.com.tw/uploads/0000/1/2022/06/20/banner-en2.jpg) !important;
    width: auto;
    height: 320px;
  }


  @media(max-width: 766px) {
    .bravo_banner {
      background-image: url(https://worktel.mrhost.com.tw/uploads/0000/1/2022/06/20/banner-en2.jpg) !important;
      width: auto !important;
      height: 200px !important;
    }



  }
</style>
<!DOCTYPE html>
<html lang="en" class="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="csrf-token" content="sxcmHHm5tPy4BxhcKH5b114cCGV2ctEKTSZdzxP0">
  <link rel="icon" type="image/vnd.microsoft.icon"
    href="https://worktel.mrhost.com.tw/uploads/0000/1/2022/03/22/favicon.png" />
  <title>mrhost-Worktel, Extended Stay &amp; Service Apartment online booking platform</title>


  <meta name="description"
    content="Taiwan extended stay, short stay, monthly hotel, workation. We have a range of brands that help you find the best hotel for your stay." />
  <meta property="og:url" content="https://worktel.mrhost.com.tw/hotel" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="mrhost-Worktel, Extended Stay &amp; Service Apartment online booking platform" />
  <meta property="og:description"
    content="Taiwan extended stay, short stay, monthly hotel, workation. We have a range of brands that help you find the best hotel for your stay." />
  <meta property="og:image" content="https://worktel.mrhost.com.tw/uploads/0000/1/2022/06/22/ally-en.jpeg" />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="mrhost-Worktel, Extended Stay &amp; Service Apartment online booking platform">
  <meta name="twitter:description"
    content="Taiwan extended stay, short stay, monthly hotel, workation. We have a range of brands that help you find the best hotel for your stay.">
  <meta name="twitter:image" content="https://worktel.mrhost.com.tw/uploads/0000/1/2022/06/22/ally-en.jpeg">
  <link rel="canonical" href="https://worktel.mrhost.com.tw/hotel" />
  <link rel="alternate" href="https://worktel.mrhost.com.tw/hotel" hreflang="x-default" />
  <link rel="alternate" href="https://worktel.mrhost.com.tw/zh/hotel" hreflang="zh" />
  <link href="https://worktel.mrhost.com.tw/libs/bootstrap/css/bootstrap.css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/libs/font-awesome/css/font-awesome.css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/libs/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/libs/icofont/icofont.min.css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/libs/select2/css/select2.min.css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/dist/frontend/css/notification.css" rel="newest stylesheet">
  <link href="https://worktel.mrhost.com.tw/dist/frontend/css/app.css?_ver=1.0.12" rel="stylesheet">

  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel='stylesheet' id='google-font-css-css'
    href='https://fonts.googleapis.com/css?family=Poppins%3A300%2C400%2C500%2C600' type='text/css' media='all' />
  <script>
    var bookingCore = {
      url: 'https://worktel.mrhost.com.tw',
      url_root: 'https://worktel.mrhost.com.tw',
      booking_decimals: 0,
      thousand_separator: ',',
      decimal_separator: '.',
      currency_position: 'left',
      currency_symbol: 'NT$',
      currency_rate: '1',
      date_format: 'MM/DD/YYYY',
      map_provider: 'gmap',
      map_gmap_key: 'AIzaSyAGDg5j4O512bsBovm1nv_AnZTaF6JESFE',
      map_options: {
        map_lat_default: '25.032969',
        map_lng_default: '121.565414',
        map_clustering: 'on',
        map_fit_bounds: 'on',
      },
      routes: {
      },
      module: {
        hotel: 'https://worktel.mrhost.com.tw/hotel',
      },
      currentUser: 0,
      isAdmin: 0,
      rtl: 0,
      markAsRead: 'https://worktel.mrhost.com.tw/notify/markAsRead',
      markAllAsRead: 'https://worktel.mrhost.com.tw/notify/markAllAsRead',
      loadNotify: 'https://worktel.mrhost.com.tw/notify/notifications',
      pusher_api_key: '',
      pusher_cluster: '',
    };
    var i18n = {
      warning: "Warning",
      success: "Success",
    };
    var daterangepickerLocale = {
      "applyLabel": "Apply",
      "cancelLabel": "Cancel",
      "fromLabel": "From",
      "toLabel": "To",
      "customRangeLabel": "Custom",
      "weekLabel": "W",
      "first_day_of_week": 1,

      "daysOfWeek": [
        "Su",
        "Mo",
        "Tu",
        "We",
        "Th",
        "Fr",
        "Sa"
      ],
      "monthNames": [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
      ],
    };
  </script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/display.css" />
  <script src="https://worktel.mrhost.com.tw/libs/vue/vue.min.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link href="https://worktel.mrhost.com.tw/dist/frontend/module/hotel/css/hotel.css?_ver=1.0.12" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/custom-css" rel="stylesheet">
  <link href="https://worktel.mrhost.com.tw/libs/carousel-2/owl.carousel.css" rel="stylesheet">

  <div id="fb-root"></div>

  <div id="fb-customer-chat" class="fb-customerchat">
  </div>
  <script>
    var chatbox = document.getElementById('fb-customer-chat');
    chatbox.setAttribute("page_id", "145891912753401");
    //   chatbox.setAttribute("page_id", "145891912753401");
    //   chatbox.setAttribute("page_id", "1149874751858022");
    chatbox.setAttribute("attribution", "biz_inbox");
    chatbox.setAttribute("theme_color", "#E97676");
    chatbox.setAttribute("logged_in_greeting", "Hi! How can we help you?");

  </script>

  <style>
    html {
      scroll-behavior: smooth;
      font-size-adjust: none;
    }

    .features-list {
      margin-top: 0;
      display: flex;
      flex-wrap: wrap;
      width: 90%;
    }

    .features-list-el {
      color: #A10508;
      font-size: 10px;
      margin-right: 5px;
    }

    .bravo_wrap .bravo_form .form-content {
      padding: 0;
    }

    .button-child {
      background-color: #CCCCCC;
      color: #A3A3A3;
    }

    .button-child-target {
      background-color: #EC3E3F;
      color: #FFFFFF;
    }

    .info {}

    .el-icon-plus {
      line-height: 2;
    }

    .el-icon-minus {
      line-height: 2;
    }


    .capabilities {
      display: flex;
      flex-wrap: wrap;
    }

    .capabilities-el {
      background-color: #F5F5F5;
      margin-right: 10px;
      border-radius: 5px;
      border: 1px solid #E0E0E0;
      padding: 3px;
      font-size: 10px;
    }

    .info .info-star {
      font-size: 18px;
      color: #484848;
      text-align: right;
    }

    .info .info-comment {
      font-size: 12px;
      color: #A3A3A3;
      text-align: right;
    }

    .render {
      margin-top: 0.2rem;
    }


    .ratings-price {
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 700;
      color: #0A588A;
      text-align: right;
    }

    .hotel-details {
      height: 200px;
      padding: 10px;
      position: relative;
    }

    .hotel-title {
      font-size: 20px;
      font-weight: 700;
    }

    .hotel-rate {
      font-size: 18px;
    }

    .image-container {
      padding: 13px;
    }

    .image-el-card {
      width: 260px;
      height: 170px;
      border-radius: 5px;
    }

    .hotel-card {
      width: 825px;
      height: 200px;
      margin-bottom: 10px;
    }

    .details-row {
      height: 70%;
    }

    .facility-row {
      position: absolute;
      bottom: 4;
    }

    .attributes-col {
      position: relative;
      height: 100%;
      margin-bottom: 10px;
    }

    .pricing-col {
      height: 100%;
      position: relative;
    }

    .el-radio-button__inner:hover {
      color: #EC3E3F;
    }


    .el-radio-button__orig-radio:checked+.el-radio-button__inner {
      color: #FFF;
      background-color: #EC3E3F;
      border-color: #DCDFE6;
    }

    .el-select-dropdown__item.selected {
      color: #EC3E3F;
      font-weight: 700;
    }

    .el-date-editor .el-range__icon {
      color: #000;
    }

    .el-tag.el-tag--info {
      background-color: #F5F5F5;
      border-color: #E0E0E0;
      color: #484848;
      font-size: 10px;
    }

    @media screen and (max-width: 820px) {
      .image-el-card {
        width: 220px;
        height: 170px;
      }

      .hotel-card {
        width: 700px;
        height: 200px;
        margin-bottom: 10px;
      }

    }

    @media screen and (max-width: 550px) {
      .ratings .ratings-price {
        text-align: left;
      }

      .card-container {
        align-items: center;
      }

      .image-el-card {
        width: 315px;
        height: 200px;
      }

      .image-container {
        padding: 1px;
      }

      .ratings-price {
        margin-bottom: 0;
      }

      .hotel-card {
        margin-left: 15;
        width: 315px;
        height: initial;
      }

      .hotel-details {
        height: initial;
        padding: 5px;
      }

      .details-row {
        height: initial;
      }

      .facility-row {
        margin-top: 10px;
        position: relative;
      }

      .pricing-col {
        height: initial;
        position: relative;
      }

      .price-btn {
        display: none;
      }

      .attributes-col {
        height: initial;
        margin-bottom: 5px;
      }

      /*
      .guests-type-selection {
        display: none;
      }
      */
    }
  </style>

</head>

<body class="frontend-page header-normal">

  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PFDMNDP" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>

  <div class="bravo_wrap" id="app">
    <div class="bravo_header">
      <div class="container">
        <div class="content">
          <div class="header-left">
            <a href="https://worktel.mrhost.com.tw" class="bravo-logo">
              <img decoding="async" src="https://worktel.mrhost.com.tw/uploads/0000/1/2022/06/21/logo-300.png"
                alt="mrhost-Worktel, Extended Stay &amp; Service Apartment online booking platform">
            </a>
            <div class="bravo-menu">
            </div>
          </div>
          <div style="margin-left: auto; margin-right: 0;">
            <el-select v-model="language" placeholder="language" @change="fetch_data">
              <el-option key="English" label="English" value="en"></el-option>
              <el-option key="繁體中文" label="繁體中文" value="zh"></el-option>
            </el-select>
          </div>
        </div>
      </div>
    </div>
    <div class="bravo_search_hotel">
      <div class="bravo_banner">
        <div class="container">
          <h1>

          </h1>
        </div>
      </div>

      <el-button id="scroll-btn" type="info" @click="back_to_top"
        style="position: fixed; bottom: 40px; right: 30px; z-index: 99; background-color: #EC3E3F;">
        <i class="el-icon-top"></i>
      </el-button>
      <div class="mb-2 pt-2 sticky-top hidden-xs-only" style="background-color: #EC3E3F;">
        <div class="container">
          <div style="display: flex; gap: 20px; padding-bottom: 10px;">
            <el-select v-model="selected_city" filterable placeholder="City">
              <!-- <el-select :xs="24" v-model="selected_city" placeholder="City"> -->
              <el-option v-for="location in locations" :label="find_location(location.id)"
                :key="location.name+location.id" :value="location.id">
                {{ find_location(location.id) }}
              </el-option>
            </el-select>
            <el-date-picker v-model="date_range" type="daterange" range-separator="|"
              :picker-options="date_picker_options">
            </el-date-picker>
            <el-dropdown class="guests-type-selection" trigger="click">
              <el-button>
                <span v-if="language ==='en' ">
                  {{num_adults}} Adults - {{num_children}} children - {{num_infants}} Infants
                  <i class="el-icon-arrow-down el-icon--right"></i>
                </span>
                <span v-else>
                  {{num_adults}} 位成人 - {{num_children}} 名孩童 - {{num_infants}} 名嬰兒
                  <i class="el-icon-arrow-down el-icon--right"></i>
                </span>
              </el-button>
              <el-dropdown-menu slot="dropdown" style="position: relative; width: 300px;">
                <el-row style="margin: 15px;" style="position: relative;">
                  <span style="margin-top: 5px;">Adults</span>
                  <el-input-number size="mini" style="position: absolute; right: 0;" v-model="num_adults" :min="1"
                    :max="20">
                  </el-input-number>
                </el-row>
                <el-row style="margin: 15px;" style="position: relative;">
                  <span>Children</span>
                  <el-input-number size="mini" style="position: absolute; right: 0;" v-model="num_children" :min="0"
                    :max="20">
                  </el-input-number>
                </el-row>
                <el-row style="margin: 15px;" style="position: relative;">
                  <span>Infants</span>
                  <el-input-number style="position: absolute; right: 0;" size="mini" v-model="num_infants" :min="0"
                    :max="20">
                  </el-input-number>
                </el-row>
              </el-dropdown-menu>
            </el-dropdown>
            <el-button style="background-color: #EC3E3F; color: #FFF;" @click="fetch_data">
              <span v-if="language === 'en'">
                SEARCH
              </span>
              <span v-else>
                搜尋
              </span>
            </el-button>
          </div>
        </div>
      </div>
      <div class="mb-2 pt-2 sticky-top hidden-sm-and-up" style="background-color: #EC3E3F;">
        <div class="container">
          <div style="display: grid; gap: 10px; padding-bottom: 10px;">
            <el-select v-model="selected_city" placeholder="City">
              <!-- <el-select :xs="24" v-model="selected_city" placeholder="City"> -->
              <el-option v-for="location in locations" :label="find_location(location.id)"
                :key="location.name+location.id" :value="location.id">
                {{ find_location(location.id) }}
              </el-option>
            </el-select>
            <el-date-picker style="width: 100%;" v-model="date_range" type="daterange" range-separator="|"
              :picker-options="date_picker_options">
            </el-date-picker>
            <el-dropdown trigger="click">
              <el-button style="width: 100%;">
                <span v-if="language ==='en' ">
                  {{num_adults}} Adults - {{num_children}} children - {{num_infants}} Infants
                  <i class="el-icon-arrow-down el-icon--right"></i>
                </span>
                <span v-else>
                  {{num_adults}} 位成人 - {{num_children}} 名孩童 - {{num_infants}} 名嬰兒
                  <i class="el-icon-arrow-down el-icon--right"></i>
                </span>
              </el-button>
              <el-dropdown-menu slot="dropdown" style="position: relative; width: 300px;">
                <el-row style="margin: 15px;" style="position: relative;">
                  <span style="margin-top: 5px;">Adults</span>
                  <el-input-number size="mini" style="position: absolute; right: 0;" v-model="num_adults" :min="1"
                    :max="20">
                  </el-input-number>
                </el-row>
                <el-row style="margin: 15px;" style="position: relative;">
                  <span>Children</span>
                  <el-input-number size="mini" style="position: absolute; right: 0;" v-model="num_children" :min="0"
                    :max="20">
                  </el-input-number>
                </el-row>
                <el-row style="margin: 15px;" style="position: relative;">
                  <span>Infants</span>
                  <el-input-number style="position: absolute; right: 0;" size="mini" v-model="num_infants" :min="0"
                    :max="20">
                  </el-input-number>
                </el-row>
              </el-dropdown-menu>
            </el-dropdown>
            <el-button style="background-color: #EC3E3F; color: #FFF;" @click="fetch_data">
              <span v-if="language === 'en'">
                SEARCH
              </span>
              <span v-else>
                搜尋
              </span>
            </el-button>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-12">
            <div class="bravo_filter">
              <el-card class="box-card" shadow="hover" :body-style="{ padding: '0px' }">
                <div slot="header" class="clearfix">
                  <span v-if="language === 'en' ">FILTER:</span>
                  <span v-else>透過以下分類搜尋:</span>
                </div>
                <el-collapse v-model="shown_attributes">
                  <el-collapse-item v-for="attribute in attributes" :name="attribute.slug">
                    <template slot="title">
                      <span style="margin-left: 1rem; font-weight: 700;"> {{ proper_language(attribute) }}</span>
                    </template>
                    <el-checkbox-group v-model="checked_attributes" @change="filter_hotels">
                      <el-col>
                        <el-row v-for="term in attribute.terms">
                          <el-checkbox :label="term.id" :key="term.id" style="margin-left: 1rem;">
                            {{ proper_language(term) }}
                          </el-checkbox>
                        </el-row>
                      </el-col>
                    </el-checkbox-group>
                  </el-collapse-item>
                </el-collapse>
              </el-card>
            </div>

          </div>
          <div class="col-lg-8 col-md-12">

            <div class="bravo-list-item">
              <div class="topbar-search" style="display: block;">
                <h2 class="text">
                  <span v-if="language==='en'">
                    {{ displayed_hotels.length }} hotel(s) found
                  </span>
                  <span v-else>
                    找到{{ displayed_hotels.length }}間住宿
                  </span>
                </h2>
                <div style="margin-top: 20px;">
                  <el-radio-group v-model="sorting_method" @change="sort_hotels">
                    <el-radio-button class="radio-btn" label="recommended">
                      <span v-if="language==='en'">Recommended</span>
                      <span v-else>爲您精選</span>
                    </el-radio-button>
                    <el-radio-button label="price_low_high">
                      <span v-if="language==='en'">Price(Low to High)</span>
                      <span v-else>價錢由低至高</span>
                    </el-radio-button>
                    <el-radio-button label="price_high_low">
                      <span v-if="language==='en'">Price(High to Low)</span>
                      <span v-else>價錢由高至低</span>
                    </el-radio-button>
                    <el-radio-button label="rating_high_low">
                      <span v-if="language==='en'">Rating(High to Low)</span>
                      <span v-else>星級最高</span>
                    </el-radio-button>
                  </el-radio-group>
                </div>
              </div>
            </div>
            <div class="list-item" style="justify-content: center;">
              <div class="text-center mx-auto" v-if="displayed_hotels.length === 0 && checked_attributes.length === 0">
                <div class="spinner-border spinner-border-lg" style=" width: 3rem; height: 3rem;" role="status">
                  <span class="sr-only">Loading...</span>
                </div>
              </div>

              <div v-for="hotel in displayed_hotels">
                <el-card class="hotel-card" :body-style="{padding: '0px'}" shadow="hover">
                  <el-col class="image-container" :xs=" 24" :sm="8" :md="8" style="position: relative;">
                    <div v-if="hotel.sold_out"
                      style="background-color: #EC3E3F; z-index: 2; position: absolute; top: 30; color: #FFF; font-weight: 500; padding: 5px;">
                      <span v-if="language === 'en'">Sold out</span>
                      <span v-else>售完</span>
                    </div>
                    <a :href="hotel.detail_url">
                      <img :src="hotel.image_id || default_url_alt" decoding="async" :alt="hotel.title"
                        class="image image-el-card" @error="fallback_url">
                    </a>

                  </el-col>
                  <el-col :xs="24" :sm="16" :md="16" class="hotel-details">
                    <el-row>
                      <span class="float-left hotel-title">{{ hotel.title }}</span>
                      <span v-if="hotel.rate" class="float-right hotel-rating">
                        {{ hotel.rate }} <i class="el-icon-star-on" style="color: #EC3E3F;"></i>
                      </span>
                      <span v-else class="float-right hotel-rating"> -- </span>
                    </el-row>
                    <el-row>
                      <span style="font-size: 12px; color: #0485D6;">
                        <i class="el-icon-location"></i> {{ find_location(hotel.location_id) }}
                      </span>
                    </el-row>
                    <el-row class="details-row">

                      <el-col :xs=" 24" :sm="16" :md="16" class="attributes-col" style="border-style: solid 2px;">
                        <el-row style="margin-top: 5px;">
                          <span v-for="attribute in parse_attributes(hotel)" class="features-list-el"
                            name="attribute.id">
                            <i class="el-icon-info"></i> {{ attribute.name }}
                          </span>
                        </el-row>
                        <el-row class="facility-row">
                          <el-tag v-for="facility in parse_facilities(hotel)" type="info" size="mini"
                            style="margin-right: 10px; margin-bottom: 5px;">
                            {{ facility.name}}
                          </el-tag>
                        </el-row>
                      </el-col>

                      <el-col :xs="24" :sm="8" :md="8" class="pricing-col">
                        <div v-if="hotel.price" class="ratings-price float-right">
                          <span v-if="language ==='en' ">
                            From {{ Math.floor(parseInt(hotel.price)) }} NT
                          </span>
                          <span v-else>
                            NT {{ Math.floor(parseInt(hotel.price)) }}起
                          </span>
                        </div>
                        <div v-else class="ratings-price float-right"> -- </div>
                        <el-button class="float-right price-btn"
                          style="position: absolute; bottom: 0; right: 0; background-color: #EC3E3F;">
                          <a :href="hotel.detail_url" style="text-decoration: none; color: #FFF;">
                            <span v-if="language === 'en'"> see</span>
                            <span v-else>查看</span>
                            <i class="el-icon-arrow-right"></i></a>
                        </el-button>
                      </el-col>
                    </el-row>
                  </el-col>
                </el-card>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bravo_footer" style="background-color: #EC3E3F; color: white;">
    <div class="copy-right">
      <div class="container context">
        <div class="row">
          <div class="col-md-12 mt-3" style="text-align:center;">
            <div style="margin:0 auto;">
              <p>Copyright © 2022 by mrhost</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <link rel="stylesheet" href="https://worktel.mrhost.com.tw/libs/flags/css/flag-icon.min.css">
  <script defer src="https://worktel.mrhost.com.tw/libs/lazy-load/intersection-observer.js"></script>
  <script async src="https://worktel.mrhost.com.tw/libs/lazy-load/lazyload.min.js"></script>
  <script>
    // Set the options to make LazyLoad self-initialize
    window.lazyLoadOptions = {
      elements_selector: ".lazy",
      // ... more custom settings?
    };

    // Listen to the initialization event and get the instance of LazyLoad
    window.addEventListener('LazyLoad::Initialized', function (event) {
      window.lazyLoadInstance = event.detail.instance;
    }, false);


  </script>
  <script defer src="https://worktel.mrhost.com.tw/libs/lodash.min.js"></script>
  <script src="https://worktel.mrhost.com.tw/libs/jquery-3.3.1.min.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/libs/bootbox/bootbox.min.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/libs/carousel-2/owl.carousel.min.js"></script>
  <script defer type="text/javascript" src="https://worktel.mrhost.com.tw/libs/daterange/moment.min.js"></script>
  <script defer type="text/javascript"
    src="https://worktel.mrhost.com.tw/libs/daterange/daterangepicker.min.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/libs/select2/js/select2.min.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/js/functions.js?_ver=1.0.12"></script>
  <script defer src="https://worktel.mrhost.com.tw/js/home.js?_ver=1.0.12"></script>
  <script defer src="https://apps.elfsight.com/p/platform.js"></script>
  <script defer src="https://worktel.mrhost.com.tw/libs/pusher.min.js"></script>
  <script type="text/javascript"
    src="https://worktel.mrhost.com.tw/libs/ion_rangeslider/js/ion.rangeSlider.min.js"></script>
  <script defer type="text/javascript"
    src="https://worktel.mrhost.com.tw/module/hotel/js/hotel.js?_ver=1.0.12"></script>
  <script>
    if (window.Worker) {
      let MAX_WORKERS = 15;
      /*
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        // true for mobile device
        MAX_WORKERS = 0;
      } else {
        // false for not mobile device
        MAX_WORKERS = 15;
      }
   */

      const today = new Date()
      const end_date = new Date(today.getTime() + 5 * 24 * 60 * 60 * 1000)
      const App = new Vue({
        el: "#app",
        data: {
          first_time: false,
          fullscreenLoading: false,
          attributes: [],
          checked_attributes: [],
          hotels: [],
          displayed_hotels: [],
          NUM_WORKERS: MAX_WORKERS,
          worker_pool: new Array(this.NUM_WORKERS),
          query_queue: [],
          locations: [],
          language: "en",
          sorting_method: "recommended",
          date_range: [today, end_date],
          shown_attributes: ["property-type", "facilities-1"],
          num_adults: 1,
          num_infants: 0,
          num_children: 0,
          selected_city: 1,
          error: 0,
          date_picker_options: {
            disabledDate(time) {
              const day = 3600 * 1000 * 24;
              return time.getTime() < Date.now() - day;
            },
          },
        },
        created: function () {
          console.log("new vue element created");
          const me = this;
          me.init();

          console.log("initialized");
        },
        mounted() {
          // pass
        },

        watch: {
          /*
      worker_pool: function () {
        const worker = this.worker_pool.find(wrk => wrk.busy === false);
        const task = this.query_queue.shift();
        if (worker === undefined || task === undefined) {
          return;
        }
        let pool_copy = [...this.worker_pool];
        pool_copy[worker.id].busy = true;
        pool_copy[worker.id].work.postMessage({task: task, id: worker.id});
        this.worker_pool = pool_copy;
        // console.log("worker is dispatched", pool_copy[worker.id]);
      },
          */
        },

        computed: {
          // In case the image_id passed is NULL
          default_url_alt: function () {
            return "https://via.placeholder.com/300x150";
          },

          parsed_attributes: function (hotel) {
            return (hotel) =>
              hotel.terms.filter((term) => {
                term.attr_id === 5;
              });
          },

          parsed_facilities: function (hotel) {
            return (hotel) =>
              hotel.terms.filter((term) => {
                term.attr_id === 6;
              });
          },
        },

        methods: {
          init: async function () {
            if (!this.first_time) {
              const parameters = {
                location_id: this.selected_city,
                locale: this.language
              };
              const api_url =
                "https://worktel.mrhost.com.tw/api/SearchHotels_v2?" + new URLSearchParams(parameters).toString();

              const resp = await fetch(api_url)
                .then((res) => res.json())
                .catch((err) => {
                  console.error(err)
                });

              console.log(resp);
              this.hotels = [...resp.hotels];
              this.worker_pool = [];
              this.dynamic_price_update();
              const sold_out = this.hotels.filter(
                (hotel) => parseInt(hotel.price) === 0 || hotel.price === null || hotel.sold_out === true
              )
              const available = this.hotels.filter(
                (hotel) => parseInt(hotel.price) > 0 && (hotel.sold_out === false || hotel.sold_out === undefined)
              )
              this.displayed_hotels = [...available, ...sold_out];
              this.attributes = resp.attributes;
              this.locations = resp.locations;
              this.first_time = true;
            } else {
              return;
            }
          },

          sort_hotels: function () {
            const sold_out = this.displayed_hotels.filter(
              (hotel) => parseInt(hotel.price) === 0 || hotel.price === null || hotel.sold_out === true
            )
            // console.log("sold out array", sold_out);
            let tmp_hotels = this.displayed_hotels.filter(
              (hotel) => parseInt(hotel.price) > 0 && (hotel.sold_out === false || hotel.sold_out === undefined)
            )
            // not too sure what recommended is about but I think it is the way we received it from the backend
            if (this.sorting_method === "recommended") {
              this.displayed_hotels = [...tmp_hotels, ...sold_out];
            } else {
              tmp_hotels = tmp_hotels.sort((a, b) => {
                if (this.sorting_method === "price_low_high")
                  return a.price - b.price;
                else if (this.sorting_method === "price_high_low")
                  return b.price - a.price;
                else if (this.sorting_method === "rating_high_low")
                  return b.rate - a.rate;
              });
              this.displayed_hotels = [...tmp_hotels, ...sold_out];
            }
          },
          filter_hotels: function () {
            let tmp_hotels = [...this.hotels];
            tmp_hotels = tmp_hotels.filter((hotel) => {
              const all_attributes = [...hotel.terms];
              let passed = true;
              for (let attr of this.checked_attributes) {
                const found = all_attributes.find(elem => elem.term_id === attr);
                if (!found) {
                  passed = false;
                  break;
                }
              }
              return passed;
            });
            const sold_out = tmp_hotels.filter(
              (hotel) => parseInt(hotel.price) === 0 || hotel.price === null || hotel.sold_out === true
            )
            const available = tmp_hotels.filter(
              (hotel) => parseInt(hotel.price) > 0 && (hotel.sold_out === false || hotel.sold_out === undefined)
            )
            this.displayed_hotels = [...available, ...sold_out];
          },

          parse_attributes: function (hotel) {
            return hotel.terms.filter((term) => term.attr_id === 5);
          },
          parse_facilities: function (hotel) {
            return hotel.terms.filter((term) => term.attr_id === 6);
          },

          find_location: function (id) {
            const location = this.locations.find((location) => location.id === id);
            const lang = (this.language === "en") ? 0 : 1;
            return location.translations[lang].name;
          },
          proper_language: function (component) {
            const lang = (this.language === "en") ? 0 : 1;
            if (component.translations.length < 2) {
              if (lang === 0) // english 
                return component.name
              return component.translations[0].name;
            }
            else
              return component.translations[lang].name;
          },

          back_to_top: function () {
            document.body.scrollTop = 0;
          },

          dynamic_price_update: function () {
            for (let i = 0; i < this.NUM_WORKERS; i++) {
              this.worker_pool[i] = {work: new Worker("./siteminder_worker.js"), id: i};
              this.worker_pool[i].work.onmessage = (e) => {
                console.log(e.data, this.worker_pool[i].id, "worker returned");
                if (e.data.error != null) {
                  this.error++;
                  return;
                }
                const array_id = e.data.hotel_in_array_id;
                const total_days = (this.date_range[1] - this.date_range[0]) / (3600 * 1000 * 24);
                this.hotels[array_id].price = Math.floor(e.data.price / total_days)
                this.hotels[array_id].sold_out = e.data.sold_out;
                // console.log(e.data.price, array_id, this.hotels)
              }
            };
            let siteminder_queue = [];
            let period = Math.floor(this.hotels.length / this.NUM_WORKERS);
            for (let id = 0; id < this.hotels.length; id++) {
              if (this.hotels[id].siteminder_digital_id != null) {
                siteminder_queue.push({
                  siteminder_id: this.hotels[id].siteminder_digital_id,
                  hotel_in_array_id: id,
                });
              };
              if ((id && (id % period === 0)) || id === this.hotels.length - 1) {
                // console.log(id, period, siteminder_queue)
                this.query_queue.push({
                  siteminder_queue: [...siteminder_queue],
                  date_start: this.date_range[0].toISOString().slice(0, 10),
                  date_end: this.date_range[1].toISOString().slice(0, 10),
                  adults: this.num_adults,
                  children: this.num_children,
                  infants: this.num_infants,
                });

                // flush the siteminder_queue
                siteminder_queue = [];
              };
            }
            console.log("query_queue", this.query_queue);

            for (let worker of this.worker_pool) {
              const task = this.query_queue.shift();
              // console.log(task, worker, this.query_queue.length)
              if (task === undefined) {
                break;
              }
              worker.work.postMessage({task: task, id: worker.id});
            };
          },

          fetch_data: async function () {
            this.displayed_hotels = [];
            this.error = 0;
            const parameters = {
              location_id: this.selected_city,
              locale: this.language
            };
            const api_url = "https://worktel.mrhost.com.tw/api/SearchHotels_v2?" + new URLSearchParams(parameters).toString();
            this.sorting_method = "recommended";
            const resp = await fetch(api_url).then((res) => res.json());
            console.log(resp);
            this.hotels = [...resp.hotels];
            this.worker_pool = [];
            this.dynamic_price_update();
            const sold_out = this.hotels.filter(
              (hotel) => parseInt(hotel.price) === 0 || hotel.price === null || hotel.sold_out === true
            );
            const available = this.hotels.filter(
              (hotel) => parseInt(hotel.price) > 0
            );
            this.displayed_hotels = [...available, ...sold_out];
            this.attributes = resp.attributes;
            this.locations = resp.locations;

          },

          fallback_url: function (event) {
            // event.target.src = "https://via.placeholder.com/300x150";
            event.target.src = "http://placekitten.com/g/300/150";
          },
        },
      });
    }

  </script>
</body>


</html>
